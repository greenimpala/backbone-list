/**
 * almond 0.2.0 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

var requirejs,require,define;(function(e){function l(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function c(t,r){return function(){return n.apply(e,f.call(arguments,0).concat([t,r]))}}function h(e){return function(t){return l(t,e)}}function p(e){return function(t){s[e]=t}}function d(n){if(o.hasOwnProperty(n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!s.hasOwnProperty(n)&&!a.hasOwnProperty(n))throw new Error("No "+n);return s[n]}function v(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function m(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=[].slice;r=function(e,t){var n,r=v(e),i=r[0];return e=r[1],i&&(i=l(i,t),n=d(i)),i?n&&n.normalize?e=n.normalize(e,h(t)):e=l(e,t):(e=l(e,t),r=v(e),i=r[0],e=r[1],i&&(n=d(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return c(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:m(e)}}},t=function(t,n,u,f){var l,h,v,m,g,y=[],b;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(g=0;g<n.length;g+=1){m=r(n[g],f),h=m.f;if(h==="require")y[g]=i.require(t);else if(h==="exports")y[g]=i.exports(t),b=!0;else if(h==="module")l=y[g]=i.module(t);else if(s.hasOwnProperty(h)||o.hasOwnProperty(h)||a.hasOwnProperty(h))y[g]=d(h);else{if(!m.p)throw new Error(t+" missing "+h);m.p.load(m.n,c(f,!0),p(h),{}),y[g]=s[h]}}v=u.apply(s[t],y);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(v!==e||!b)s[t]=v}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):d(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},15),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),o[e]=[e,t,n]},define.amd={jQuery:!0}})(),define("almond",function(){}),define("list/view/NodeView",[],function(){var e=Backbone.View.extend({initialize:function(){this.model.on("highlight",this.highlightTitle,this),this.model.on("resetTitle",this.clearTitleHighlights,this)},events:{"dblclick .title":"edit","blur .title-edit":"cancelEdit","keypress .title-edit":"saveEditOnEnter","click .title":"fireUserOnClick"},edit:function(e){e.stopImmediatePropagation();if(this.model.get("editable")!==!0)return;this.$el.find(".title:first").hide(),this.$el.addClass("editing"),this.$el.find(".title-edit:first").show().find("input").focus()},cancelEdit:function(e){e.stopImmediatePropagation(),this.$el.find(".title-edit:first").hide().find("input").val(this.model.get("title")),this.$el.find(".title:first").show(),this.$el.removeClass("editing")},saveEditOnEnter:function(e){e.stopImmediatePropagation();var t=$.trim(e.target.value),n=13;e.which===n&&t.length>0&&(this.model.set("title",e.target.value),this.render(),this.$el.removeClass("editing"))},fireUserOnClick:function(e){e.stopImmediatePropagation();var t=this.model.get("onClick");t&&_.isFunction(t)&&t(this.model),this.model.trigger("clicked",this.model)},highlightTitle:function(e,t){var n=this.model.get("title"),r=n.substring(0,e),i=n.substring(e,t),s=n.substring(t,n.length);this.$el.find(".title:first").html(r+'<span class="highlight">'+i+"</span>"+s)},clearTitleHighlights:function(){this.$el.find(".title:first").html(this.model.get("title"))}});return e}),define("list/Dispatcher",[],function(){var e=_.clone(Backbone.Events);return e}),define("list/model/Node",["list/Dispatcher"],function(e){var t=Backbone.Model.extend({defaults:{visible:!0},initialize:function(){this.on("all",function(){e.trigger.apply(e,arguments)})}});return t}),define("list/model/Leaf",["list/model/Node"],function(e){var t=e.extend({defaults:{icon:""},initialize:function(){e.prototype.initialize.call(this)},toJSON:function(){return{model:this.JSON_EXPORT,parameters:{title:this.get("title")}}}},{JSON_EXPORT:"Leaf"});return t}),define("list/model/Composite",["list/model/Node"],function(e){var t=e.extend({defaults:{icon:"",visible:!1},initialize:function(){e.prototype.initialize.call(this),this.set("children",new Backbone.Collection)},add:function(e){this.get("children").add(e)},remove:function(e){this.get("children").remove(e)},getChildren:function(e){if(!e)return this.get("children").toArray();var t=[];return this.get("children").forEach(function(e){e.getChildren&&(t=t.concat(e.getChildren(!0))),t.push(e)}),t},toJSON:function(){var e=[];return this.get("children").forEach(function(t){e.push(t.toJSON())}),{model:this.JSON_EXPORT,parameters:{visible:this.get("visible"),title:this.get("title")},children:e}}},{JSON_EXPORT:"Composite"});return t}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("ï»¿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!list/templates/LeafView.html",[],function(){return'<div class="leaf-content">\n    <span class="icon leaf-icon {{icon}}"></span>\n    {{> NodeView}}\n</div>'}),define("list/view/LeafView",["list/view/NodeView","text!list/templates/LeafView.html"],function(e,t){var n=e.extend({className:"node leaf",tagName:"li",template:Handlebars.compile(t),events:{},initialize:function(){this.events=_.extend({},e.prototype.events,this.events),e.prototype.initialize.call(this)},render:function(){var e=this.template(this.model.attributes);return this.$el.html(e),this}});return n}),define("text!list/templates/CompositeView.html",[],function(){return'<div class="composite-content">\n    <span class="expander">\n        <span class="icon expander-icon {{#if visible}}open{{/if}}"></span>\n    </span>\n    <span class="icon composite-icon {{icon}} {{#if visible}}open{{/if}}"></span>\n    {{> NodeView}}\n</div>'}),define("list/view/CompositeView",["list/view/NodeView","list/model/Leaf","list/model/Composite","list/view/LeafView","text!list/templates/CompositeView.html"],function(e,t,n,r,i){var s=e.extend({className:"node composite",tagName:"li",template:Handlebars.compile(i),childViews:null,_$header:null,_$children:null,events:{"click .composite-content .expander":"showHideChildren","click .composite-content .icon":"showHideChildren"},initialize:function(){this.events=_.extend({},e.prototype.events,this.events),e.prototype.initialize.call(this),this.childViews={},this.model.get("children").on("add",this.addChildViewForModel,this),this.model.get("children").on("remove",this.removeChildViewForModel,this),this.model.on("change:visible",this.onVisibilityChange,this),this._$header=$(this.make("div")).appendTo(this.el),this._$children=$(this.make("ul")).appendTo(this.el)},render:function(){return this._renderHeader(),this._renderChildren(),this},addChildViewForModel:function(e){this._createChildView(e),e instanceof n&&e.get("children").each(function(t){e.get("children").trigger("add",t)})},removeChildViewForModel:function(e){this._deleteChildView(e)},onVisibilityChange:function(){var e=this.$el.find("ul:first");this.$el.find("span.expander-icon:first, span.composite-icon:first").toggleClass("open",this.model.get("visible")),this.options.animate?e.slideToggle("fast"):e.toggle()},showHideChildren:function(e){e.stopImmediatePropagation();var t=this.model.get("visible");this.model.set("visible",t?!1:!0)},_createChildView:function(e){var i,o={model:e,animate:this.options.animate};return e instanceof t?i=new r(o):e instanceof n&&(i=new s(o)),this.childViews[e.cid]=i,i},_deleteChildView:function(e){this.childViews[e.cid].remove(),delete this.childViews[e.cid]},_renderHeader:function(){var e=this.template(this.model.attributes);this._$header.html(e)},_renderChildren:function(){var e=document.createDocumentFragment();_.each(this.childViews,function(t){e.appendChild(t.render().el)},this),this._$children.toggle(this.model.get("visible")).html(e)}});return s}),define("text!list/templates/_NodeView.html",[],function(){return'<span class="title-edit" style="display: none">\n    <input value="{{title}}" />\n    <span>Press enter to save</span>\n</span>\n<span class="title" title="Double-click to edit">\n    {{title}}\n</span>'}),define("text!list/templates/Search.html",[],function(){return'<div id="search">\n    <input type="text">\n    <div id="results" style="display: none">\n        <span class="ticker"><strong>0</strong> results found.</span>\n        <span class="highlight" id="clear-results"> (Clear)</span>\n    </div>\n</div>'}),define("list/model/List",["list/model/Composite","list/model/Leaf"],function(e,t){var n=e.extend({_lastSearch:null,initialize:function(){e.prototype.initialize.call(this),this.set("visible",!0),this.on("all",this.dispatchEvent,this)},search:function(e){_.each(this._lastSearch,function(e){e.trigger("resetTitle")});var t=this.getChildren(!0),n;return n=_.filter(t,function(t){var n=t.get("title").toLowerCase().indexOf(e.toLowerCase());return n>=0&&e!==""?(t.trigger("highlight",n,n+e.length),!0):!1}),this.trigger("search",n),this._lastSearch=n,n},deserialize:function(e){var t=_.isString(e)?JSON.parse(e):e,n=this._deserializeChildren(t);this.add(n)},_deserializeChildren:function(e){var t=[];return _.each(e,function(e){var n=this._deserializeChild(e);n&&t.push(n)},this),t},_deserializeChild:function(n){var r;return n.model===t.JSON_EXPORT?r=new t(n.parameters):n.model===e.JSON_EXPORT&&(r=new e(n.parameters),n.children&&r.add(this._deserializeChildren(n.children))),r},toJSON:function(){return e.prototype.toJSON.call(this).children}});return n}),define("list/view/ListView",["list/view/CompositeView","text!list/templates/_NodeView.html","text!list/templates/Search.html","list/model/List"],function(e,t,n,r){var i=e.extend({tagName:"div",className:"list",searchTemplate:Handlebars.compile(n),_$searchField:null,_$searchResults:null,events:{"click #clear-results":"clearResults","keyup #search input":"onSearchKeypress"},initialize:function(){_.bindAll(this,"onSearchKeypress","clearResults"),this.model.on("search",this.updateTicker,this),this.options.search&&this._initializeSearch(),this.registerPartials(),e.prototype.initialize.call(this)},registerPartials:function(){Handlebars.registerPartial("NodeView",t)},clearResults:function(){this._$searchField.val("").keyup().focus()},render:function(){return this._renderChildren(),this},onSearchKeypress:function(){var e=$.trim(this._$searchField.val());this.model.search(e),this._$searchResults.toggle(e.length>0)},updateTicker:function(e){this._$searchResults.find("strong").html(e.length)},_initializeSearch:function(){this.$el.append(this.searchTemplate()),this._$searchField=this.$el.find("#search input"),this._$searchResults=this.$el.find("#search #results")}});return i})